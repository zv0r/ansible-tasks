---
- name: Install dependencies
  ansible.builtin.apt:
    name: nfs-common
    update_cache: true
    state: present

- name: Prepare website directory
  ansible.builtin.file:
    path: "{{ yararchive_mirror_website_directory }}"
    owner: root
    group: root
    mode: "0755"
    force: false
    state: directory

- name: Prepare fstab
  ansible.posix.mount:
    src: "{{ fstab_mount_source }}"
    path: "{{ yararchive_mirror_website_directory }}"
    opts: "ro,noexec,nosuid,nodev"
    state: mounted
    boot: true
    fstype: nfs

- name: Setup nginx
  ansible.builtin.include_role:
    name: setup_nginx_reverse_proxy
  vars:
    template_file_name: mirror.yararchive.ru.conf.j2
    nginx_server_config_file_name: mirror.yararchive.ru.conf
    nginx_server_listen_port: 443
